{
  "version": 3,
  "sources": ["../../src/pylontech/WorkerNet.ts"],
  "sourcesContent": ["// Copyright (c) 2020-2023 Tr\u00E4ger\n\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the \"Software\"),\n// to deal in the Software without restriction, including without limitation\n// the rights to use, copy, modify, merge, publish, distribute, sublicense,\n// and/or sell copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n// DEALINGS IN THE SOFTWARE.\n\nimport Debug from 'debug';\nimport * as net from 'net';\nimport WorkerAbstract from './WorkerAbstract';\n\nconst debugApi = Debug('pylontech:api');\n\nexport = class WorkerNet extends WorkerAbstract {\n  protected _socket: net.Socket = new net.Socket();\n  protected _host: string;\n  protected _port: number;\n\n  constructor(host: string, port: number, model: string, noPrompt?: boolean, debugData?: (data: Buffer) => void) {\n    debugApi('MyWorkerNet.constructor', 'host:', host, 'port:', port);\n    super(model);\n    if (debugData) this._socket.on('data', debugData);\n    if (noPrompt) this._noPrompt = noPrompt;\n    this._host = host;\n    this._port = port;\n    this._socket.pipe(this._consolenReader);\n  }\n\n  open(): Promise<void> {\n    return new Promise<void>(\n      ((resolve: () => void, reject: (err: Error) => void) => {\n        this._socket.on('error', reject);\n        this._socket.connect(\n          this._port,\n          this._host,\n          (() => {\n            this._connected();\n            resolve();\n          }).bind(this)\n        );\n      }).bind(this)\n    );\n  }\n\n  /*\n  protected _rfc2217_will(): void {\n    const data = Buffer.from('FFFB2C', 'hex');\n    this.sendDataB(data);\n  }\n\n  protected _rfc2217_setBaudRate(baudRate: number): void {\n    this._rfc2217_will();\n    const data = Buffer.from('fffa2c0100000000fff0', 'hex');\n    data.writeUInt32BE(baudRate, 4);\n    this.sendDataB(data);\n  }\n\n  protected _rfc2217_setDatasize(datasize: number): void {\n    this._rfc2217_will();\n    const data = Buffer.from('fffa2c0200fff0', 'hex');\n    data.writeUInt8(datasize, 4);\n    this.sendDataB(data);\n  }\n\n  protected _rfc2217_setParity(parity: number): void {\n    this._rfc2217_will();\n    const data = Buffer.from('fffa2c0300fff0', 'hex');\n    data.writeUInt8(parity, 4);\n    this.sendDataB(data);\n  }\n\n  protected _rfc2217_setStopsize(stopsize: number): void {\n    this._rfc2217_will();\n    const data = Buffer.from('fffa2c0400fff0', 'hex');\n    data.writeUInt8(stopsize, 4);\n    this.sendDataB(data);\n  }\n  protected _rfc2217_setControl(control: number): void {\n    this._rfc2217_will();\n    const data = Buffer.from('fffa2c0500fff0', 'hex');\n    data.writeUInt8(control, 4);\n    this.sendDataB(data);\n  }\n*/\n\n  sendDataB(data: Buffer): void {\n    debugApi('MyWorkerNet.sendDataB', 'data:', data.toString('hex'), 'this._activeCmd:', this._activeCmd);\n    this._socket.write(data);\n  }\n\n  sendData(data: string): void {\n    debugApi('MyWorkerNet.sendData', 'data:', data, 'this._activeCmd:', this._activeCmd);\n    this._socket.write(data);\n  }\n\n  close(): Promise<boolean> {\n    debugApi('MyWorkerNet.close');\n    return new Promise<boolean>(resolve => {\n      this._socket.end(() => {\n        resolve(true);\n      });\n    });\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAoBA,mBAAkB;AAClB,UAAqB;AACrB,4BAA2B;AAE3B,MAAM,eAAW,aAAAA,SAAM,eAAe;AAEtC,iBAAS,MAAM,kBAAkB,sBAAAC,QAAe;AAAA,EAK9C,YAAY,MAAc,MAAc,OAAe,UAAoB,WAAoC;AAC7G,aAAS,2BAA2B,SAAS,MAAM,SAAS,IAAI;AAChE,UAAM,KAAK;AANb,SAAU,UAAsB,IAAI,IAAI,OAAO;AAO7C,QAAI;AAAW,WAAK,QAAQ,GAAG,QAAQ,SAAS;AAChD,QAAI;AAAU,WAAK,YAAY;AAC/B,SAAK,QAAQ;AACb,SAAK,QAAQ;AACb,SAAK,QAAQ,KAAK,KAAK,eAAe;AAAA,EACxC;AAAA,EAEA,OAAsB;AACpB,WAAO,IAAI;AAAA,OACR,CAAC,SAAqB,WAAiC;AACtD,aAAK,QAAQ,GAAG,SAAS,MAAM;AAC/B,aAAK,QAAQ;AAAA,UACX,KAAK;AAAA,UACL,KAAK;AAAA,WACJ,MAAM;AACL,iBAAK,WAAW;AAChB,oBAAQ;AAAA,UACV,GAAG,KAAK,IAAI;AAAA,QACd;AAAA,MACF,GAAG,KAAK,IAAI;AAAA,IACd;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA2CA,UAAU,MAAoB;AAC5B,aAAS,yBAAyB,SAAS,KAAK,SAAS,KAAK,GAAG,oBAAoB,KAAK,UAAU;AACpG,SAAK,QAAQ,MAAM,IAAI;AAAA,EACzB;AAAA,EAEA,SAAS,MAAoB;AAC3B,aAAS,wBAAwB,SAAS,MAAM,oBAAoB,KAAK,UAAU;AACnF,SAAK,QAAQ,MAAM,IAAI;AAAA,EACzB;AAAA,EAEA,QAA0B;AACxB,aAAS,mBAAmB;AAC5B,WAAO,IAAI,QAAiB,aAAW;AACrC,WAAK,QAAQ,IAAI,MAAM;AACrB,gBAAQ,IAAI;AAAA,MACd,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AACF;",
  "names": ["Debug", "WorkerAbstract"]
}
